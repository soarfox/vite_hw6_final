import{_ as k,r as g,o as n,c as d,a as t,F as v,f as I,g as i,t as c,b as r,w as x,d as f,i as C,v as y,n as b}from"./index-c0c3596b.js";const{VITE_API:u,VITE_APIPATH:m}={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_APIPATH:"cheetah116",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0},O={data(){return{testTesting:"test 123456789",isLoading:!0,loadingColor:"#FFC78E",loadingBackgroundColor:"#FFFAF4",apiUrl:"https://vue3-course-api.hexschool.io/v2",apiPath:"cheetah116",products:[],pageObj:{},singleProduct:{},singleCartData:{},cartList:[],cartProducts:[],formOrder:{user:{email:"",name:"",tel:"",address:""},message:""},loadingStatus:{loadingItem:""}}},methods:{getCartList(){this.$http.get(`${u}/api/${m}/cart`).then(a=>{this.cartList=a.data.data,this.cartProducts=this.cartList.carts}).catch(a=>{console.dir(a)})},removeCartItem(a){this.loadingStatus.loadingItem=a,this.$http.delete(`${u}/api/${m}/cart/${a}`).then(s=>{this.loadingStatus.loadingItem="",alert("已刪除該產品"),this.getCartList()}).catch(s=>{alert(s.data.message)})},deleteAllCartItem(){this.$http.delete(`${u}/api/${m}/carts`).then(a=>{alert("已清空購物車"),this.getCartList()}).catch(a=>{alert(a.data.message)})},updateCart(a){this.loadingStatus.loadingItem=a.id,this.singleCartData.product_id=a.product_id,this.singleCartData.qty=a.qty,this.$http.put(`${u}/api/${m}/cart/${a.id}`,{data:this.singleCartData}).then(s=>{this.loadingStatus.loadingItem="",alert("已更新購物車"),this.getCartList()}).catch(s=>{this.loadingStatus.loadingItem="",alert(s.data.message)})},createOrder(){this.cartProducts.length===0?alert("購物車內無品項, 無法送出訂單"):this.$http.post(`${u}/api/${m}/order`,{data:this.formOrder}).then(a=>{alert("已送出訂單"),this.getCartList(),this.$refs.formContent.resetForm(),this.formOrder.message=""}).catch(a=>{alert(a.data.message)})}},components:{},mounted(){this.getCartList()}},P={class:"container col-8"},S={key:0},E={class:"table align-middle"},A=t("thead",null,[t("tr",null,[t("th"),t("th",null,"品名"),t("th",null,"單價"),t("th",{class:"text-center"},"數量/單位"),t("th",{class:"text-end"},"金額小計")])],-1),D=["onClick","disabled"],F={key:0,class:"fas fa-spinner fa-pulse"},T={key:0,class:"text-success"},U={class:"input-group input-group-sm"},q={class:"input-group mb-3"},w=["onUpdate:modelValue","onBlur","disabled"],B={class:"input-group-text",id:"basic-addon2"},N={class:"text-end"},R={key:0,class:"text-success"},j=t("td",{colspan:"4",class:"text-end"},"總計",-1),H={class:"text-end"},M={key:0},$=t("td",{colspan:"4",class:"text-end text-success"},"折扣價",-1),z={class:"text-end text-success"},G={class:"text-end"},J=["disabled"],K={key:1,class:"card"},Q={class:"card-body text-center"},W=t("h5",{class:"card-title"},"購物車是空的",-1),X=t("hr",null,null,-1),Y={class:"my-5 row justify-content-center"},Z=t("h3",{class:"text-center"},"請填寫訂單資訊",-1),tt={class:"mb-3"},et=t("label",{for:"name",class:"form-label"},"姓名",-1),st={class:"mb-3"},lt=t("label",{for:"email",class:"form-label"},"Email",-1),at={class:"mb-3"},ot=t("label",{for:"tel",class:"form-label"},"電話 (請輸入09開頭的手機號碼)",-1),rt={class:"mb-3"},nt=t("label",{for:"address",class:"form-label"},"地址",-1),dt={class:"mb-3"},it=t("label",{for:"message",class:"form-label"},"留言",-1),ct=t("div",{class:"text-end"},[t("button",{class:"btn btn-danger",type:"submit"},"送出訂單")],-1);function ut(a,s,mt,ht,e,h){const V=g("RouterLink"),_=g("v-field"),p=g("error-message"),L=g("v-form");return n(),d(v,null,[t("div",P,[this.cartProducts.length?(n(),d("div",S,[t("table",E,[A,t("tbody",null,[e.cartList?(n(!0),d(v,{key:0},I(e.cartProducts,l=>(n(),d("tr",{key:l.id},[t("td",null,[t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:o=>h.removeCartItem(l.id),disabled:e.loadingStatus.loadingItem===l.id},[e.loadingStatus.loadingItem===l.id?(n(),d("i",F)):i("",!0),f(" x ")],8,D)]),t("td",null,[f(c(l.product.title)+" ",1),l.coupon?(n(),d("div",T," 已套用優惠券 ")):i("",!0)]),t("td",null,c(l.product.price),1),t("td",null,[t("div",U,[t("div",q,[C(t("input",{"onUpdate:modelValue":o=>l.qty=o,min:"1",type:"number",class:"form-control text-end",onBlur:o=>h.updateCart(l),disabled:e.loadingStatus.loadingItem===l.id},null,40,w),[[y,l.qty,void 0,{number:!0}]]),t("span",B,c(l.product.unit),1)])])]),t("td",N,[e.cartList.total!==e.cartList.final_total?(n(),d("small",R,"折扣價：")):i("",!0),f(" "+c(l.final_total),1)])]))),128)):i("",!0)]),t("tfoot",null,[t("tr",null,[j,t("td",H,c(e.cartList.total),1)]),e.cartList.total!==e.cartList.final_total?(n(),d("tr",M,[$,t("td",z,c(e.cartList.final_total),1)])):i("",!0)])]),t("div",G,[t("button",{class:"btn btn-outline-secondary",type:"button",onClick:s[0]||(s[0]=l=>h.deleteAllCartItem()),disabled:!this.cartProducts.length},"清空購物車",8,J)])])):i("",!0),this.cartProducts.length?i("",!0):(n(),d("div",K,[t("div",Q,[W,X,r(V,{to:"/products",class:"btn btn-danger w-60"},{default:x(()=>[f(" 按我去選購 ")]),_:1})])]))]),t("div",Y,[Z,r(L,{ref:"formContent",class:"col-md-6",onSubmit:s[6]||(s[6]=l=>h.createOrder())},{default:x(({errors:l})=>[t("div",tt,[et,r(_,{id:"name",name:"姓名",type:"text",class:b(["form-control",{"is-invalid":l.姓名}]),rules:"required",modelValue:e.formOrder.user.name,"onUpdate:modelValue":s[1]||(s[1]=o=>e.formOrder.user.name=o),placeholder:"請輸入姓名"},null,8,["modelValue","class"]),r(p,{name:"姓名",class:"invalid-feedback"})]),t("div",st,[lt,r(_,{id:"email",name:"email",type:"email",class:b(["form-control",{"is-invalid":l.email}]),rules:"email|required",modelValue:e.formOrder.user.email,"onUpdate:modelValue":s[2]||(s[2]=o=>e.formOrder.user.email=o),placeholder:"請輸入Email"},null,8,["modelValue","class"]),r(p,{name:"email",class:"invalid-feedback"})]),t("div",at,[ot,r(_,{id:"tel",name:"電話",type:"tel",class:b(["form-control",{"is-invalid":l.電話}]),rules:{regex:/^(09)[0-9]{8}$/,required:!0},modelValue:e.formOrder.user.tel,"onUpdate:modelValue":s[3]||(s[3]=o=>e.formOrder.user.tel=o),placeholder:"請輸入電話"},null,8,["rules","modelValue","class"]),r(p,{name:"電話",class:"invalid-feedback"})]),t("div",rt,[nt,r(_,{id:"address",name:"地址",type:"text",class:b(["form-control",{"is-invalid":l.地址}]),rules:"required",modelValue:e.formOrder.user.address,"onUpdate:modelValue":s[4]||(s[4]=o=>e.formOrder.user.address=o),placeholder:"請輸入地址"},null,8,["modelValue","class"]),r(p,{name:"地址",class:"invalid-feedback"})]),t("div",dt,[it,C(t("textarea",{id:"message",name:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":s[5]||(s[5]=o=>e.formOrder.message=o),placeholder:"請輸入留言"},`
                  `,512),[[y,e.formOrder.message]])]),ct]),_:1},512)])],64)}const pt=k(O,[["render",ut]]);export{pt as default};
